<!DOCTYPE html>
<html>
<head>
  <title>ANGUSâ„¢ â€” Builder Deep Dive (Q07â€“Q30)</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #050608;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .chat-box {
      max-width: 780px;
      margin: 30px auto;
      background: #0f0f0f;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.85);
      border: 1px solid #222;
    }
    .message {
      margin: 14px 0;
      line-height: 1.6;
      animation: fadeIn 0.45s ease-in;
    }
    .bot { color: #f5f5f5; }
    .user {
      color: #D4A72C;
      text-align: right;
      font-weight: 600;
    }
    .step-label {
      font-size: 14px;
      font-weight: 600;
      color: #D4A72C;
      margin-bottom: 4px;
    }
    .options button {
      display: block;
      width: 100%;
      padding: 10px 14px;
      margin: 6px 0;
      border-radius: 10px;
      border: 1px solid #D4A72C;
      background: #111;
      color: #f5f5f5;
      text-align: left;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.2s ease;
    }
    .options button:hover,
    .options button.selected {
      background: #D4A72C;
      color: #050608;
      box-shadow: 0 0 18px rgba(212,167,44,0.45);
      transform: translateY(-2px);
    }
    textarea, input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      background: #111;
      border: 2px solid #333;
      color: #f5f5f5;
      font-size: 15px;
      box-sizing: border-box;
      font-family: 'Inter', Arial, sans-serif;
    }
    textarea { 
      min-height: 90px; 
      resize: vertical; 
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #D4A72C;
      box-shadow: 0 0 10px rgba(212,167,44,0.35);
    }
    .next-btn, .submit-btn {
      background: #D4A72C;
      color: #050608;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    .next-btn:hover, .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 18px rgba(212,167,44,0.45);
    }
    .loading {
      color: #D4A72C;
      font-style: italic;
    }
    .loading::after {
      content: "...";
      animation: dots 1.5s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes dots {
      0% { content: ""; }
      33% { content: "."; }
      66% { content: ".."; }
      100% { content: "..."; }
    }
    @media(max-width: 600px) {
      .chat-box { padding: 20px; margin: 10px auto; }
    }
  </style>
</head>

<body>
  <div class="chat-box" id="chat"></div>

  <script>
    const chat = document.getElementById("chat");
    const BACKEND_URL = "/submit";

    // =============================
    // Q07â€“Q30 WITH customInputIndex ADDED FOR "Other"
    // =============================

    const steps = [

      // Q07 (no Other)
      { type: "text",
        question: "Q07 â€” Where do you show up online right now â€” and how big is your audience there?",
        placeholder: "Be specific. Example: Facebook (800 friends), IG (350 followers)..."
      },

      // Q08 (no Other)
      { type: "single",
        question: "Q08 â€” Social Presence Snapshot",
        options: [
          "ğŸ§â€â™‚ï¸ I barely post â€” mostly invisible online",
          "ğŸ“… I post sometimes, but not consistently",
          "ğŸ” I post consistently but not business-focused yet",
          "ğŸ‘€ Small audience, light engagement",
          "ğŸ”¥ Engaged community â€” people respond to me",
          "ğŸ¥ I create content regularly (stories, reels, videos)",
          "ğŸ‘» I mostly consume â€” not a creator yet"
        ]
      },

      // Q09 (no Other)
      { type: "single",
        question: "Q09 â€” Content Confidence (1â€“10)",
        options: [
          "1ï¸âƒ£ 1 â€“ I freeze up. Zero confidence.",
          "2ï¸âƒ£ 2",
          "3ï¸âƒ£ 3",
          "4ï¸âƒ£ 4",
          "5ï¸âƒ£ 5 â€“ I could try with help.",
          "6ï¸âƒ£ 6",
          "7ï¸âƒ£ 7",
          "8ï¸âƒ£ 8 â€“ I'm comfortable.",
          "9ï¸âƒ£ 9",
          "ğŸ”Ÿ 10 â€“ Give me the plan, Commander."
        ]
      },

      // Q10 (text)
      { type: "text",
        question: "Q10 â€” 90-Day Definition of 'This WORKED'",
        placeholder: "Paint the picture. What does it worked look like?"
      },

      // Q11 â€” HAS OTHER (index 7)
      { type: "single",
        question: "Q11 â€” Desired Outcome",
        options: [
          "ğŸ’° More income",
          "ğŸ•Š More freedom",
          "ğŸ’ª More confidence",
          "âš¡ï¸ More energy",
          "ğŸ“… More structure",
          "ğŸ¯ More purpose",
          "ğŸ¤ More community",
          "âœï¸ Something else (type in)"
        ],
        customInputIndex: 7
      },

      // Q12 (text)
      { type: "text",
        question: "Q12 â€” Why That Outcome Matters",
        placeholder: "Why does this outcome matter emotionally or practically?"
      },

      // Q13 (text)
      { type: "text",
        question: "Q13 â€” Weekly Schedule Reality",
        placeholder: "Describe your real weekly schedule. No sugarcoating."
      },

      // Q14 (multi, no Other)
      { type: "multi",
        question: "Q14 â€” Highest Energy Windows",
        options: [
          "ğŸŒ… Early morning (5â€“8am)",
          "ğŸŒ Mid-morning (8â€“11am)",
          "ğŸ± Afternoon (11amâ€“3pm)",
          "ğŸŒ‡ Late afternoon (3â€“6pm)",
          "ğŸŒ™ Evening (6â€“9pm)",
          "ğŸŒŒ Late night (9pm+)",
          "ğŸ”„ It varies",
          "âš¡ï¸ Depends on my work/kids schedule"
        ]
      },

      // Q15 (text)
      { type: "text",
        question: "Q15 â€” Commitments We Must Build Around",
        placeholder: "Work, family, church, kids, sports, appointments, etc."
      },

      // Q16 â€” HAS OTHER (index 8)
      { type: "multi",
        question: "Q16 â€” What Helps You Stay Consistent?",
        options: [
          "ğŸ—º Clear steps",
          "ğŸ“Š Tracking progress",
          "ğŸ™‹â€â™€ï¸ Accountability",
          "ğŸ‘¥ Community support",
          "ğŸ“† Routine + structure",
          "ğŸ§  Strong why",
          "â± Deadlines",
          "ğŸ”¥ Momentum",
          "âœï¸ Other"
        ],
        customInputIndex: 8
      },

      // Q17 â€” HAS OTHER (index 8)
      { type: "multi",
        question: "Q17 â€” What Usually Pulls You Off Track?",
        options: [
          "ğŸ§± Lack of structure",
          "ğŸŒ€ Overthinking",
          "ğŸŒª Life chaos",
          "ğŸ˜¬ Doubting myself",
          "ğŸ”‡ Losing momentum",
          "ğŸ­ Trying to do it alone",
          "â° Too many responsibilities",
          "ğŸ’­ Not seeing results fast enough",
          "âœï¸ Other"
        ],
        customInputIndex: 8
      },
      // Q18 (no Other)
      { type: "single",
        question: "Q18 â€” Stress/Discouragement Response",
        options: [
          "ğŸ“´ I shut down",
          "ğŸ¢ I slow way down",
          "ğŸ§—â€â™‚ï¸ I push harder",
          "ğŸ™ˆ I avoid tasks",
          "ğŸ¤¯ I get overwhelmed",
          "ğŸ™‹â€â™‚ï¸ I ask for help",
          "ğŸ”„ It depends"
        ]
      },

      // Q19 â€” HAS OTHER (index 10)
      { type: "multi",
        question: "Q19 â€” Strengths You Bring",
        options: [
          "ğŸ—£ Talking to people",
          "ğŸ’¬ Encouraging others",
          "ğŸ“± Social posting",
          "ğŸ¨ Creativity",
          "ğŸ§¹ Organization",
          "ğŸ” Consistency",
          "ğŸ“ Learning quickly",
          "ğŸ“ Following a plan",
          "ğŸ”Š Storytelling",
          "ğŸŒ± Leadership potential",
          "âœï¸ Other"
        ],
        customInputIndex: 10
      },

      // Q20 â€” HAS OTHER (index 8)
      { type: "single",
        question: "Q20 â€” Skill You Want the MOST Help With",
        options: [
          "ğŸ—£ Talking to people confidently",
          "âœï¸ Posting content consistently",
          "ğŸ¤ Starting conversations",
          "ğŸ” Following a daily system",
          "â± Time management",
          "ğŸ”¥ Building habit momentum",
          "ğŸ¯ Staying accountable",
          "ğŸ§© Understanding the business flow",
          "âœ¨ Something else"
        ],
        customInputIndex: 8
      },

      // Q21 (no Other)
      { type: "single",
        question: "Q21 â€” System-Following Confidence (1â€“10)",
        options: [
          "1ï¸âƒ£ 1","2ï¸âƒ£ 2","3ï¸âƒ£ 3","4ï¸âƒ£ 4","5ï¸âƒ£ 5",
          "6ï¸âƒ£ 6","7ï¸âƒ£ 7","8ï¸âƒ£ 8","9ï¸âƒ£ 9","ğŸ”Ÿ 10"
        ]
      },

      // Q22 (text)
      { type: "text",
        question: "Q22 â€” What Would $300â€“$800/month Support Right Now?",
        placeholder: "Where would that income go? Be real about it."
      },

      // Q23 (text)
      { type: "text",
        question: "Q23 â€” Biggest Fear or Hesitation",
        placeholder: "What scares you or makes you hesitate? No emojis."
      },

      // Q24 (text)
      { type: "text",
        question: "Q24 â€” If Nothing Changes in 6 Months, What Worries You Most?",
        placeholder: "Write what's true. This helps your coach lead you."
      },

      // Q25 (text)
      { type: "text",
        question: "Q25 â€” Who You Want to Become in 12 Months",
        placeholder: "Describe the version of you we're building."
      },

      // Q26 â€” HAS OTHER (index 7)
      { type: "single",
        question: "Q26 â€” One Feeling You NEVER Want Again",
        options: [
          "ğŸ˜ Feeling stuck",
          "ğŸ˜° Anxiety",
          "ğŸ˜¤ Overwhelm",
          "ğŸ˜” Insecurity",
          "ğŸ˜© Exhaustion",
          "ğŸ¥± Burnout",
          "ğŸ§â€â™‚ï¸ Feeling alone",
          "âœï¸ Other"
        ],
        customInputIndex: 7
      },

      // Q27 (no Other)
      { type: "single",
        question: "Q27 â€” One Feeling You WANT as Your Baseline",
        options: [
          "ğŸ’ª Confidence","âœ¨ Clarity","ğŸ”‹ Energy","ğŸŒ¼ Peace",
          "ğŸš€ Momentum","ğŸ¯ Purpose","ğŸ˜„ Joy","ğŸ”¥ Drive"
        ]
      },

      // Q28 (no Other)
      { type: "single",
        question: "Q28 â€” Preferred Accountability Style",
        options: [
          "ğŸ¤ Gentle encouragement",
          "ğŸ”¥ Direct challenge",
          "ğŸ§­ Step-by-step guidance",
          "ğŸ§˜ Light-touch check-ins",
          "ğŸ‘¯ Partnership/teamwork",
          "ğŸ¯ Hybrid approach"
        ]
      },

      // Q29 (no Other)
      { type: "multi",
        question: "Q29 â€” Preferred Tracking Style",
        options: [
          "â˜‘ï¸ Daily check marks",
          "ğŸ† Weekly wins",
          "ğŸ”‹ Energy levels",
          "ğŸ’› Confidence levels",
          "ğŸ’µ Income movement",
          "ğŸ§¬ Habit improvements",
          "ğŸ’¬ Emotional check-ins"
        ]
      },

      // Q30 (text)
      { type: "text",
        question: "Q30 â€” Why is NOW the right time to build something?",
        placeholder: "This is your emotional tattoo moment."
      },

      // Final â€” Email
      { type: "email",
        question: "Finally â€” what's the BEST email for your 90-day Legacy Builder projection?"
      }
    ];

    // =============================
    // ENGINE
    // =============================

    const TOTAL_STEPS = steps.length;
    let currentStep = -1;
    let answers = [];
    let userEmail = "";

    function showBotMessage(msg) {
      chat.innerHTML += `<div class="message bot">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    
    function showUserMessage(msg) {
      chat.innerHTML += `<div class="message user">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    
    function showLoading() {
      chat.innerHTML += `<div class="message loading" id="loading">ANGUS is thinking</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    
    function hideLoading() {
      const l = document.getElementById("loading");
      if (l) l.remove();
    }

    function renderStep() {
      currentStep++;
      if (currentStep >= TOTAL_STEPS) return;

      const step = steps[currentStep];
      showLoading();

      setTimeout(() => {
        hideLoading();

        showBotMessage(
          `<div class='step-label'>Step ${currentStep + 1} of ${TOTAL_STEPS}</div>` +
          step.question
        );

        if (step.type === "single" || step.type === "multi") {
          let html = `<div class="options" id="options-${currentStep}">`;
          step.options.forEach((opt, idx) => {

            // NEW: Custom OTHER button
            if (step.customInputIndex !== undefined && idx === step.customInputIndex) {
              html += `<button class="option-btn custom-other-btn" data-step="${currentStep}" data-type="${step.type}" data-index="${idx}">${opt}</button>`;
            } else {
              html += `<button class="option-btn" data-step="${currentStep}" data-type="${step.type}" data-index="${idx}">${opt}</button>`;
            }

          });
          html += `</div>`;
          chat.innerHTML += html;

          if (step.type === "multi") {
            chat.innerHTML += `<button class="next-btn" id="next-${currentStep}">Next</button>`;
          }
        }

        if (step.type === "text") {
          chat.innerHTML += `
            <div id="text-block-${currentStep}">
              <textarea id="text-input-${currentStep}" placeholder="${step.placeholder || ''}"></textarea>
              <button class="next-btn" id="text-next-${currentStep}">Next</button>
            </div>`;
        }

        if (step.type === "email") {
          chat.innerHTML += `
            <div id="email-block">
              <input id="email-input" type="text" placeholder="Enter your email address...">
              <button class="submit-btn" id="email-submit">Submit</button>
            </div>`;
        }

        chat.scrollTop = chat.scrollHeight;
        setupEventListeners();
        
      }, 700);
    }

    function setupEventListeners() {

      // ===========================
      // NEW: OTHER â†’ Custom input
      // ===========================
      document.querySelectorAll('.custom-other-btn').forEach(btn => {
        btn.onclick = function() {

          const stepNum = parseInt(this.dataset.step);
          const step = steps[stepNum];
          const optionText = step.options[step.customInputIndex];

          showUserMessage(optionText);

          document.getElementById(`options-${stepNum}`).remove();
          const nextBtn = document.getElementById(`next-${stepNum}`);
          if (nextBtn) nextBtn.remove();

          chat.innerHTML += `
            <div id="custom-block-${stepNum}">
              <textarea id="custom-input-${stepNum}" placeholder="Type your exact answer..."></textarea>
              <button class="next-btn" id="custom-next-${stepNum}">Next</button>
            </div>
          `;

          document.getElementById(`custom-next-${stepNum}`).onclick = function() {
            const val = document.getElementById(`custom-input-${stepNum}`).value.trim();
            if (!val) {
              showBotMessage("Type your answer to continue.");
              return;
            }

            const combined = `${optionText} â€” ${val}`;

            showUserMessage(val);
            answers.push(combined);

            document.getElementById(`custom-block-${stepNum}`).remove();
            setTimeout(renderStep, 300);
          };
        };
      });

      // ===========================
      // Normal SINGLE + MULTI
      // ===========================
      document.querySelectorAll('.option-btn:not(.custom-other-btn)').forEach(btn => {
        btn.onclick = function() {
          const stepNum = parseInt(this.dataset.step);
          const type = this.dataset.type;
          const index = parseInt(this.dataset.index);
          const value = steps[stepNum].options[index];
          
          if (type === 'single') {
            this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            showUserMessage(value);
            answers.push(value);
            
            this.parentElement.remove();
            const nextBtn = document.getElementById(`next-${stepNum}`);
            if (nextBtn) nextBtn.remove();
            
            setTimeout(renderStep, 300);
          } else {
            this.classList.toggle('selected');
          }
        };
      });
      
      // MULTI Next buttons
      document.querySelectorAll('.next-btn').forEach(btn => {
        if (btn.id.startsWith('next-')) {
          btn.onclick = function() {
            const stepNum = parseInt(this.id.replace('next-', ''));
            const container = document.getElementById(`options-${stepNum}`);
            const selected = [...container.querySelectorAll('button.selected')].map(b => {
              const idx = parseInt(b.dataset.index);
              return steps[stepNum].options[idx];
            });
            
            if (selected.length === 0) {
              showBotMessage("Select at least one option.");
              return;
            }
            
            showUserMessage(selected.join(", "));
            answers.push(selected.join(", "));
            container.remove();
            this.remove();
            
            setTimeout(renderStep, 300);
          };
        }
        
        // Text Next
        if (btn.id.startsWith('text-next-')) {
          btn.onclick = function() {
            const stepNum = parseInt(this.id.replace('text-next-', ''));
            const input = document.getElementById(`text-input-${stepNum}`);
            const val = input.value.trim();
            
            if (!val) {
              showBotMessage("Type your answer to continue.");
              return;
            }
            
            showUserMessage(val);
            answers.push(val);
            
            document.getElementById(`text-block-${stepNum}`).remove();
            setTimeout(renderStep, 300);
          };
        }
      });
      
      // EMAIL Submit
      const emailSubmit = document.getElementById('email-submit');
      if (emailSubmit) {
        emailSubmit.onclick = function() {
          const emailInput = document.getElementById("email-input");
          const email = emailInput.value.trim();
          
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          
          if (!email) {
            showBotMessage("Please enter your email address to continue.");
            return;
          }
          
          if (!emailRegex.test(email)) {
            showBotMessage("Please enter a valid email address (example: name@company.com)");
            emailInput.style.borderColor = '#ff6b6b';
            emailInput.focus();
            return;
          }
          
          userEmail = email;
          showUserMessage(email);
          document.getElementById("email-block").remove();
          submitSurvey();
        };
      }
    }

    function submitSurvey() {

      showLoading();

      if (!Array.isArray(answers)) answers = [];

      fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: userEmail,
          answers: answers
        })
      })
      .then(res => {
        if (!res.ok) throw new Error(`Server responded with status ${res.status}`);
        return res.json();
      })
      .then(data => {
        hideLoading();
        if (data.redirect_url) {
          window.top.location.href = data.redirect_url;
        } else {
          showBotMessage("Success! Your responses have been recorded.");
        }
      })
      .catch(err => {
        console.error("Submit error:", err);
        hideLoading();
        showBotMessage("There was an issue submitting your responses. Please refresh and try again.");
      });
    }

    window.onload = () => {
      showBotMessage(
        "Alright legend â€” I'm ANGUSâ„¢. We're about to get precise. Answer honestly. This is for YOUR 90-day build."
      );
      setTimeout(renderStep, 1400);
    };

  </script>
</body>
</html>
